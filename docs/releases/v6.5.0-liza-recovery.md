# v6.5.0 - LIZA Production Recovery & Proactive Intelligence

**Date**: December 2025
**Codename**: "Phoenix"

## Overview
This imperative update resolves critical stability issues impacting LIZA in the Vercel Production environment and restores the "magic" of her proactive behavior. It addresses the `500 Internal Server Error` caused by Edge Runtime timeouts and eliminates the race conditions preventing parallel 3D navigation and text responses.

## Key Changes

### 1. Production API Stabilization
*   **Node.js Runtime**: Switched `api/liza/chat.js` from `edge` to `nodejs` to prevent strict timeline enforcement on complex AI reasoning chains.
*   **Single-Shot Architecture**: Removed the redundant "Second Request" pattern. The API now processes Tool Calls and Text generation in a single pass, halving latency and eliminating timeout risks during "Painting" operations.

### 2. Proactive "Neuro-Architect" Restored
*   **Context-Aware Navigation**: Restored LIZA's ability to **automatically navigate** to relevant buildings when explaining topics (e.g., asking about "Experience" automatically flies the camera to the Experience towers).
*   **Semantic Association**: Enriched the System Prompt with semantic descriptors for buildings (e.g., "The Obsidian Towers" for Experience), improving the model's spatial reasoning.

### 3. Client-Side Synchronization Fix
*   **Decoupled Rendering**: Implemented a micro-delay (500ms) for text messages in `useLizaChat.js`. This prevents the React DOM update (Chat Bubble) from cannibalizing the frame time needed for the Three.js Scene update (Camera Flight), solving the "Text cancels Navigation" bug.
*   **Sync Logic in Tour**: Refactored `useLizaTour` to use synchronous state updates, removing legacy race conditions.

### 4. Multilingual Enforcement
*   **Spanish Support**: Added `CRITICAL` instructions to the System Prompt to force response detection in the user's language, overriding previous "English Only" degradations.

## Technical Details

### Files Modified
*   `api/liza/chat.js`: Runtime switch & logic optimization.
*   `src/hooks/liza/useLizaChat.js`: Render scheduling fix.
*   `src/hooks/liza/useLizaTour.js`: State sync fix.
*   `src/utils/liza/liza-prompts.js`: Prompt engineering (Proactivity + Language).
*   `liza-api-handler.js`: converted to **Dev Adapter** to ensure local `npm run dev` executes the exact production code.

## Verification
*   **Local**: Verified via `npm run dev` with the new Adapter.
*   **Production**: Ready for deployment.
